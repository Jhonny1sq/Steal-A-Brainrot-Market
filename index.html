<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Brainrot Market</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="https://wepik.com/api/image/local/157243393/a02bafb9-15a8-4284-9daf-a6400c33da53?expires=1761192000&thumb=1&transparent=0&signature=a6015b205eff1a6deef684b5bfe2d1cbad1e48c26933c7602644b7fa6fe47af6" type="image/png">
</head>
<body class="bg-gray-950 text-white">
  <nav class="flex items-center justify-between px-6 py-4 bg-gray-900 shadow-lg">
    <div class="flex items-center space-x-2">
      <img src="https://i.redd.it/all-my-funny-cat-pictures-i-made-for-my-pfp-i-have-begun-v0-y0ne5wcdi5gb1.jpg?width=828&format=pjpg&auto=webp&s=5f5eed4f1cdb924a5afc1fb3a2fc5b958cc2e32f"
           alt="Logo" class="w-10 h-10 rounded-full">
      <h1 class="text-2xl font-bold">Brainrot Market</h1>
    </div>

    <div>
      <button
        id="linkBtn"
        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-xl font-semibold transition">
        Link Roblox Account
      </button>
    </div>
  </nav>

  <section id="welcomeSection" class="p-8 hidden">
    <h2 class="text-xl font-semibold mb-4">Welcome to Steal A Brainrot Market</h2>
    <p>Welcome let's get u started first let's link your roblox account!.</p>
    <button
        id="linkBtn2"
        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-xl font-semibold transition">
        Link Roblox Account
      </button>
      <button
        id="SkipBtn"
        class="px-4 py-2 bg-green-700 hover:bg-green-800 rounded-xl font-semibold transition">
        Skip Step For Now
      </button>
  </section>

  <script>
    const hasVisited = localStorage.getItem('visitedBrainrotMarket');
    const welcomeSection = document.getElementById('welcomeSection');
    const skip = document.getElementById('SkipBtn');
    const linkButtons = document.querySelectorAll('#linkBtn, #linkBtn2');

    async function linkByUsername() {
      const username = prompt("Enter your Roblox username:");
      if (!username) return;

      try {
        const userRes = await fetch(`/.netlify/functions/get-user?username=${encodeURIComponent(username)}`);
        if (!userRes.ok) throw new Error("User not found");
        const userData = await userRes.json();

        const userEntry = userData?.data?.[0];
        if (!userEntry) throw new Error("No user found");

        const userId = userEntry.id;

        const headshotRes = await fetch(`/.netlify/functions/get-headshot?userId=${encodeURIComponent(userId)}&size=420x420`);
        if (!headshotRes.ok) throw new Error("Failed to get avatar");
        const headshotData = await headshotRes.json();
        const avatarUrl = headshotData?.data?.[0]?.imageUrl;

        if (!avatarUrl) throw new Error("No avatar image returned");

        let profileDiv = document.getElementById('profile');
        if (!profileDiv) {
          profileDiv = document.createElement('div');
          profileDiv.id = 'profile';
          document.body.appendChild(profileDiv);
        }

        profileDiv.innerHTML = `
          <h3 class="mt-4 text-xl font-semibold">${username}</h3>
          <img src="${avatarUrl}" class="w-24 h-24 rounded-full mt-2"/>
        `;

        localStorage.setItem('linkedRoblox', JSON.stringify({ username, userId, avatarUrl }));

        alert(`Linked Roblox account: ${username}`);
        welcomeSection.classList.add('hidden');
      } catch (err) {
        alert("Could not find that Roblox username.");
        console.error(err);
      }
    }

    linkButtons.forEach(btn => btn.addEventListener('click', linkByUsername));

    if (!hasVisited) {
      welcomeSection.classList.remove('hidden');
      localStorage.setItem('visitedBrainrotMarket', 'true');
      if (skip) {
        skip.addEventListener('click', () => {
          welcomeSection.classList.add('hidden');
        });
      }
    }
  </script>

</body>
</html>