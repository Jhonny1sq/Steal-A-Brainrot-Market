<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Brainrot Market</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="https://wepik.com/api/image/local/157243393/a02bafb9-15a8-4284-9daf-a6400c33da53?expires=1761192000&thumb=1&transparent=0&signature=a6015b205eff1a6deef684b5bfe2d1cbad1e48c26933c7602644b7fa6fe47af6" type="image/png">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <meta name="google-signin-client_id" content="261028400031-8oi83h2l70rkll5t73rl0jv1ugb57iko.apps.googleusercontent.com">
  <style>
    .online-dot {
      width: 10px;
      height: 10px;
      border-radius: 9999px;
      background: #22c55e;
      border: 2px solid rgba(0,0,0,0.6);
      position: absolute;
      bottom: 0;
      right: 0;
      box-shadow: 0 0 0 2px rgba(0,0,0,0.25);
    }
  </style>
</head>
<body class="bg-gray-950 text-white min-h-screen">
  <nav class="flex items-center justify-between px-6 py-4 bg-gray-900 shadow-lg">
    <div class="flex items-center space-x-2">
      <img src="https://i.redd.it/all-my-funny-cat-pictures-i-made-for-my-pfp-i-have-begun-v0-y0ne5wcdi5gb1.jpg?width=828&format=pjpg&auto=webp&s=5f5eed4f1cdb924a5afc1fb3a2fc5b958cc2e32f" alt="Logo" class="w-10 h-10 rounded-full">
      <h1 class="text-2xl font-bold">Brainrot Market</h1>
    </div>
    <div class="flex items-center space-x-4">
      <button id="settingsBtn" class="px-3 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg font-medium transition">⚙️ Settings</button>
      <div id="accountArea"></div>
    </div>
  </nav>

  <div id="settingsPanel" class="fixed top-0 right-0 w-80 h-full bg-gray-900 shadow-lg transform translate-x-full transition-transform duration-300 z-50 p-6">
    <h2 class="text-xl font-bold mb-4">Settings</h2>
    <div class="space-y-4">
      <div>
        <label class="block mb-1 font-semibold">Profile Picture</label>
        <input type="file" id="profilePicInput" accept="image/*" class="w-full text-sm text-gray-300">
      </div>
      <div>
        <label class="block mb-1 font-semibold">Display Name</label>
        <input type="text" id="displayNameInput" placeholder="Enter a new name" class="w-full px-3 py-2 bg-gray-800 rounded-lg text-white focus:outline-none">
      </div>
      <button id="saveSettingsBtn" class="w-full mt-4 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold">Save</button>
      <button id="clearDataBtn" class="w-full px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-semibold">Clear Local Data</button>
    </div>
  </div>

  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40"></div>

  <section id="welcomeSection" class="p-8 hidden">
    <h2 class="text-xl font-semibold mb-4">Welcome to Brainrot Market</h2>
    <p>Let's get you started — first link your Google account!</p>
    <div class="mt-4">
      <div id="g_id_onload_2"
           data-client_id="261028400031-8oi83h2l70rkll5t73rl0jv1ugb57iko.apps.googleusercontent.com"
           data-context="signin"
           data-ux_mode="popup"
           data-callback="handleCredentialResponse"
           data-auto_prompt="false"></div>
      <div class="g_id_signin"
           data-type="standard"
           data-shape="rectangular"
           data-theme="filled_blue"
           data-text="signin_with"
           data-size="large"
           data-logo_alignment="left"></div>
    </div>
    <button id="SkipBtn" class="mt-4 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-xl font-semibold transition">Skip Step For Now</button>
  </section>

  <script>
  const hasVisited = localStorage.getItem('visitedBrainrotMarket')
  const welcomeSection = document.getElementById('welcomeSection')
  const skip = document.getElementById('SkipBtn')
  const accountArea = document.getElementById('accountArea')
  const settingsBtn = document.getElementById('settingsBtn')
  const settingsPanel = document.getElementById('settingsPanel')
  const overlay = document.getElementById('overlay')
  const clearDataBtn = document.getElementById('clearDataBtn')
  const profilePicInput = document.getElementById('profilePicInput')
  const displayNameInput = document.getElementById('displayNameInput')
  const saveSettingsBtn = document.getElementById('saveSettingsBtn')

  // Show welcome section if first time
  if (!hasVisited) {
    welcomeSection.classList.remove('hidden')
    localStorage.setItem('visitedBrainrotMarket', 'true')
    if (skip) skip.addEventListener('click', () => welcomeSection.classList.add('hidden'))
  }

  let savedUser = JSON.parse(localStorage.getItem('linkedGoogleUser'))
  if (savedUser) renderLinkedAccount(savedUser)
  else showLoginPrompt()

  function showLoginPrompt() {
    accountArea.innerHTML = `
      <div>
        <div id="g_id_onload"
          data-client_id="261028400031-8oi83h2l70rkll5t73rl0jv1ugb57iko.apps.googleusercontent.com"
          data-context="signin"
          data-ux_mode="popup"
          data-callback="handleCredentialResponse"
          data-auto_prompt="false"></div>
        <div class="g_id_signin"
          data-type="standard"
          data-shape="rectangular"
          data-theme="filled_blue"
          data-text="signin_with"
          data-size="medium"
          data-logo_alignment="left"></div>
      </div>
    `
  }

  function handleCredentialResponse(response) {
    const token = response.credential
    const payload = JSON.parse(atob(token.split('.')[1]))
    const user = { name: payload.name, picture: payload.picture, email: payload.email }
    localStorage.setItem('linkedGoogleUser', JSON.stringify(user))
    renderLinkedAccount(user)
    welcomeSection.classList.add('hidden')
  }

  function renderLinkedAccount(user) {
    accountArea.innerHTML = `
      <div class="flex items-center space-x-3">
        <div class="relative">
          <img src="${user.picture}" class="w-10 h-10 rounded-full object-cover">
          <div class="online-dot"></div>
        </div>
        <span class="font-semibold">${user.name}</span>
        <button id="logoutBtn" class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded-lg text-sm">Sign Out</button>
      </div>
    `
    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('linkedGoogleUser')
      showLoginPrompt()
    })
  }

  settingsBtn.addEventListener('click', () => {
    settingsPanel.classList.toggle('translate-x-full')
    overlay.classList.toggle('hidden')
  })

  overlay.addEventListener('click', () => {
    settingsPanel.classList.add('translate-x-full')
    overlay.classList.add('hidden')
  })

  clearDataBtn.addEventListener('click', () => {
    localStorage.clear()
    location.reload() // reload immediately to reset UI
  })

  saveSettingsBtn.addEventListener('click', () => {
    let user = JSON.parse(localStorage.getItem('linkedGoogleUser')) || { name: "Guest", picture: "https://cdn-icons-png.flaticon.com/512/847/847969.png" }
    const newName = displayNameInput.value.trim()
    if (newName) {
      const existingUsers = JSON.parse(localStorage.getItem('existingNames')) || []
      let finalName = newName
      let count = 1
      while (existingUsers.includes(finalName)) {
        finalName = `${newName}${count}`
        count++
      }
      user.name = finalName
      if (!existingUsers.includes(finalName)) existingUsers.push(finalName)
      localStorage.setItem('existingNames', JSON.stringify(existingUsers))
    }
    if (profilePicInput.files[0]) {
      const reader = new FileReader()
      reader.onload = e => {
        user.picture = e.target.result
        localStorage.setItem('linkedGoogleUser', JSON.stringify(user))
        renderLinkedAccount(user)
      }
      reader.readAsDataURL(profilePicInput.files[0])
    } else {
      localStorage.setItem('linkedGoogleUser', JSON.stringify(user))
      renderLinkedAccount(user)
    }
    settingsPanel.classList.add('translate-x-full')
    overlay.classList.add('hidden')
  })
</script>
</body>
</html>
